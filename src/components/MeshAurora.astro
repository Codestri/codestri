---
const horizontal = Array.from({ length: 22 }, (_, i) => i);
const vertical = Array.from({ length: 34 }, (_, i) => i);

const waveY = (x: number, row: number) => {
  const base = 160 + row * 22;
  const ampA = 26 + (row % 5) * 2;
  const ampB = 10 + (row % 3) * 2;
  return (
    base +
    Math.sin((x / 170) + row * 0.34) * ampA +
    Math.cos((x / 95) + row * 0.19) * ampB
  );
};

const waveX = (y: number, col: number) => {
  const base = 60 + col * 40;
  const ampA = 18 + (col % 4) * 2;
  const ampB = 8 + (col % 3) * 2;
  return (
    base +
    Math.sin((y / 160) + col * 0.27) * ampA +
    Math.cos((y / 120) + col * 0.17) * ampB
  );
};

const horizontalPaths = horizontal.map((row) => {
  const points = Array.from({ length: 52 }, (_, i) => {
    const x = -80 + i * 34;
    const y = waveY(x, row);
    return `${x},${y.toFixed(2)}`;
  });
  return points.join(' ');
});

const verticalPaths = vertical.map((col) => {
  const points = Array.from({ length: 38 }, (_, i) => {
    const y = 80 + i * 24;
    const x = waveX(y, col);
    return `${x.toFixed(2)},${y}`;
  });
  return points.join(' ');
});
---

<div class="mesh-aurora" aria-hidden="true">
  <svg class="mesh-aurora__svg" viewBox="0 0 1440 900" preserveAspectRatio="xMidYMid slice">
    <defs>
      <linearGradient id="meshStrokeA" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#8bd5ff" stop-opacity="0.62" />
        <stop offset="55%" stop-color="#67e8f9" stop-opacity="0.58" />
        <stop offset="100%" stop-color="#a78bfa" stop-opacity="0.5" />
      </linearGradient>
      <filter id="meshGlow" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="0.55" />
      </filter>
    </defs>

    <g class="mesh-layer mesh-layer--h" filter="url(#meshGlow)">
      {horizontalPaths.map((d) => (
        <polyline points={d} fill="none" stroke="url(#meshStrokeA)" stroke-width="0.65" stroke-linecap="round" stroke-opacity="0.82" />
      ))}
    </g>

    <g class="mesh-layer mesh-layer--v" filter="url(#meshGlow)">
      {verticalPaths.map((d) => (
        <polyline points={d} fill="none" stroke="url(#meshStrokeA)" stroke-width="0.45" stroke-linecap="round" stroke-opacity="0.45" />
      ))}
    </g>
  </svg>
</div>

<style>
  .mesh-aurora {
    position: absolute;
    inset: 0;
    z-index: 1;
    pointer-events: none;
    overflow: hidden;
    opacity: 0.78;
    mix-blend-mode: screen;
  }

  .mesh-aurora__svg {
    width: 122%;
    height: 122%;
    transform: translate(-9%, -8%);
  }

  .mesh-layer {
    transform-origin: center;
  }

  .mesh-layer--h {
    animation: meshWaveH 14s ease-in-out infinite alternate;
  }

  .mesh-layer--v {
    animation: meshWaveV 18s ease-in-out infinite alternate;
  }

  @keyframes meshWaveH {
    0% { transform: translate3d(-16px, -10px, 0) scale(1.01); }
    100% { transform: translate3d(20px, 10px, 0) scale(1.04); }
  }

  @keyframes meshWaveV {
    0% { transform: translate3d(12px, 14px, 0) scale(1.02); }
    100% { transform: translate3d(-16px, -10px, 0) scale(1.04); }
  }

  @media (prefers-reduced-motion: reduce) {
    .mesh-layer--h,
    .mesh-layer--v {
      animation: none !important;
    }
  }
</style>
